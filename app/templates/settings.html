{% extends "base.html" %}

{% block title %}Settings{% endblock %}

{% block styles %}
  <style>
    .container {
      text-align: left;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      padding: 20px;
    }
    .indent {
      margin-left: 20px;
    }
  </style>
{% endblock %}

{% block content %}
  <form method="post" action="/settings">
    <h1>Settings</h1>

    Click "Save" to apply your changes. Login with Google to save your settings and progress across sessions.

    <br><br>

    <h3>Review Settings</h3>

    <label for="translation">Bible Translation:</label>
    <select name="translation" id="translation">
      {% for trans in avail_translations %}
        <option value="{{ trans }}"
          {% if trans == selected_translation %}selected{% endif %}>
          {{ trans | upper }}
        </option>
      {% endfor %}
    </select>

    <br><br>

    <label for="priority">Verse Priority:</label>
    <select name="priority" id="priority">
      <option value="uniform" {% if priority == "uniform" %}selected{% endif %}>Uniform</option>
      <option value="weighted" {% if priority == "weighted" %}selected{% endif %}>Weighted</option>
    </select>

    <br><br>
    
    <label for="selector">Selection Method:</label>
    <select name="selector" id="selector">
      <option value="random" {% if selector == "random" %}selected{% endif %}>Random</option>
      <option value="greedy" {% if selector == "greedy" %}selected{% endif %}>Greedy</option>
    </select>

    <p id="method-description" style="font-style: italic; color: #444; margin-bottom: 2em;"></p>

    <h3>Review Selection</h3>

    <ul>
      <li>Select testaments, books, and/or chapters to review. If none are selected, defaults to the whole Bible.</li>
      <li>If a testament is selected, all of its books are included. Similarly, if a book is selected, all of its chapters are included. Otherwise, only selected chapters are included.</li>
    </ul>
    <br>

    <label>
      <input type="checkbox" name="selected_testaments" value="old"
        {% if "old" in selected_testaments %}checked{% endif %}>
      <strong>Old Testament</strong><br><br>
    </label>
    <div class="indent">
      {% for book in ot_books %}
        <label>
          <input type="checkbox" name="selected_books" value="{{ book }}"
            {% if book in selected_books %}checked{% endif %}>
          {{ book }}
        </label>
        {% if book in chapter_counts and chapter_counts[book] > 1 %}
          <div class="indent">
            {% for chapter in range(1, chapter_counts[book] + 1) %}
              <label>
                <input type="checkbox" name="selected_chapters"
                       value="{{ book }}|{{ chapter }}"
                       {% if book in selected_chapters and chapter in selected_chapters[book] %}checked{% endif %}>
                {{ chapter }}
              </label>
            {% endfor %}
          </div>
        {% else %}
          <br>
        {% endif %}
        <br>
      {% endfor %}
    </div>

    <br>
    <label>
      <input type="checkbox" name="selected_testaments" value="new"
        {% if "new" in selected_testaments %}checked{% endif %}>
      <strong>New Testament</strong><br><br>
    </label>
    <div class="indent">
      {% for book in nt_books %}
        <label>
          <input type="checkbox" name="selected_books" value="{{ book }}"
            {% if book in selected_books %}checked{% endif %}>
          {{ book }}
        </label>
        {% if book in chapter_counts and chapter_counts[book] > 1 %}
          <div class="indent">
            {% for chapter in range(1, chapter_counts[book] + 1) %}
              <label>
                <input type="checkbox" name="selected_chapters"
                       value="{{ book }}|{{ chapter }}"
                       {% if book in selected_chapters and chapter in selected_chapters[book] %}checked{% endif %}>
                {{ chapter }}
              </label>
            {% endfor %}
          </div>
        {% else %}
          <br>
        {% endif %}
        <br>
      {% endfor %}
    </div>

    <br>
    <button type="submit" style="font-size: 1em;">Save</button>
  </form>

  <script>
    const translationSelect = document.getElementById("translation");
    const prioritySelect = document.getElementById("priority");
    const selectorSelect = document.getElementById("selector");
    const description = document.getElementById("method-description");

    function updateDescription() {
      const translation = translationSelect.value.toUpperCase();
      const priority = prioritySelect.value;
      const selector = selectorSelect.value;

      let desc = `Using verse text from the ${translation} translation. `;

      if (selector === "random") {
        desc += "Randomly select verses from review selection with probability proportional to weight, ";
      } else if (selector === "greedy") {
        desc += "Select verses from review selection with the highest weight, ";
      }

      if (priority === "weighted") {
        desc += `with greater initial weight given to more commonly cited verses in <a href=https://www.gty.org/>gty.org</a> sermons and <a href=https://www.desiringgod.org/>desiringgod.org</a> resources. `;
      } else {
        desc += "with equal initial weight given to all verses. ";
      }

      desc += "Verse weights are scaled down when recently reviewed and inflated when past due."

      description.innerHTML = desc;
    }

    // Initialize and bind listeners
    translationSelect.addEventListener("change", updateDescription);
    prioritySelect.addEventListener("change", updateDescription);
    selectorSelect.addEventListener("change", updateDescription);

    // Call once on page load
    updateDescription();
  </script>
{% endblock %}
